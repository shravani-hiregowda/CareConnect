<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareConnect - Patient Portal</title>

    <!-- styles -->
    <link rel="stylesheet" href="/frontend/static/css/patient_dashboard.css">

    <!-- LIVEKIT MUST LOAD FIRST -->
    <script>
        console.log("Loading custom LiveKit UMD...");

        const lkScript = document.createElement("script");
        lkScript.src = "/frontend/static/js/livekit-client.umd.js";
        lkScript.onload = () => {
            console.log("✔ UMD Loaded. window.livekit=", window.livekit);

            // Normalize names
            window.LiveKit = window.livekit || window.LiveKit;
            window.livekit = window.livekit || window.LiveKit;
        };
        lkScript.onerror = () => console.error("❌ Failed to load custom UMD!");
        document.head.appendChild(lkScript);
    </script>

    <!-- axios must load BEFORE videoCall.js -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- Patient Dashboard (normal) -->
    <script src="/frontend/static/js/patient_dashboard.js" defer></script>

    <!-- Video call logic (depends on LiveKit + dashboard) -->
     <script src="/frontend/static/js/doctorAvatar.js" defer></script>
    <script src="/frontend/static/js/videoCall.js" defer></script>
        <script src="/frontend/static/js/voiceCallDialog.js" defer></script>

</head>

<body>
    <!-- Mobile Menu Button -->
    <button class="mobile-menu-btn" id="mobileMenuBtn">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
    </button>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        </svg>
        <span id="toastMessage">Action completed successfully!</span>
    </div>

    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <button class="close-sidebar" id="closeSidebar">&times;</button>
                
                <div class="logo">
                    <div class="logo-icon">C</div>
                    <a href="/frontend/templates/homepage.html" style="text-decoration: none; color: inherit;"> <div class="logo-text"><h4>CareConnect</h4></div></a>
                </div>
                <div class="patient-info" onclick="showPage('profile')">
                    <div class="patient-avatar">JD</div>
                    <div class="patient-details">
                        <h4>John Doe</h4>
                        <p>Patient ID: P-2024-0156</p>
                    </div>
                </div>
            </div>

            <nav class="sidebar-menu">
                <div class="menu-item active" onclick="showPage('dashboard')">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                    </svg>
                    <span>Dashboard</span>
                </div>
                <div class="menu-item" onclick="showPage('chatbot')">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
                    </svg>
                    <span>AI Health Assistant</span>
                </div>
                <div class="menu-item" onclick="showPage('appointments')">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    <span>My Appointments</span>
                </div>
                <div class="menu-item" onclick="showPage('medications')">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                    </svg>
                    <span>Medications</span>
                </div>
                <div class="menu-item" onclick="showPage('reports')">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    <span>Medical Reports</span>
                </div>
                <div class="menu-item" onclick="showPage('notifications')">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                    </svg>
                    <span>Notifications</span>
                    <span class="notification-badge">3</span>
                </div>
                <div class="menu-item" onclick="showPage('profile')">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                    <span>My Profile</span>
                </div>
                <div class="menu-item" onclick="showPage('settings')">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                    <span>Settings</span>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <div>
                    <h1 class="page-title" id="pageTitle">Dashboard</h1>
                    <p class="page-subtitle" id="pageSubtitle">Welcome back, John! Here's your health overview.</p>
                </div>
                <div class="top-actions">
                    <button class="btn btn-primary" onclick="openCallSelectionModal()">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="18" height="18">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                        </svg>
                        Speak with Doctor
                    </button>
                </div>
            </div>

            <!-- Dashboard Page -->
            <div class="page-content active" id="dashboard-page">
                <!-- Quick Actions -->
                <div class="quick-actions">
                    <div class="quick-action-card" onclick="showPage('chatbot')">
                        <div class="quick-action-icon" style="background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="28" height="28">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
                            </svg>
                        </div>
                        <div class="quick-action-info">
                            <h3>AI Health Assistant</h3>
                            <p>Get instant answers to your health questions</p>
                        </div>
                    </div>
                    <div class="quick-action-card" onclick="bookAppointment()">
                        <div class="quick-action-icon" style="background: linear-gradient(135deg, var(--success), #2d8e47);">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="28" height="28">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                        </div>
                        <div class="quick-action-info">
                            <h3>Book Appointment</h3>
                            <p>Schedule a visit with your doctor</p>
                        </div>
                    </div>
                    <div class="quick-action-card" onclick="showPage('medications')">
                        <div class="quick-action-icon" style="background: linear-gradient(135deg, var(--warning), #e6a700);">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="28" height="28">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                            </svg>
                        </div>
                        <div class="quick-action-info">
                            <h3>Medication Reminder</h3>
                            <p>View and manage your medications</p>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Grid -->
                <div class="dashboard-grid">
                    <!-- Upcoming Appointments -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3 class="card-title">Upcoming Appointments</h3>
                            <span class="view-all" onclick="showPage('appointments')">View All</span>
                        </div>
                        <div class="appointments-list">
                            <div class="appointment-item" onclick="viewAppointmentDetails()">
                                <div class="appointment-date">
                                    <div class="appointment-day">15</div>
                                    <div class="appointment-month">MAR</div>
                                </div>
                                <div class="appointment-details">
                                    <h4>Dr. Sarah Johnson</h4>
                                    <p>Cardiology • 10:00 AM</p>
                                </div>
                                <div class="appointment-status status-confirmed">Confirmed</div>
                            </div>
                            <div class="appointment-item" onclick="viewAppointmentDetails()">
                                <div class="appointment-date">
                                    <div class="appointment-day">22</div>
                                    <div class="appointment-month">MAR</div>
                                </div>
                                <div class="appointment-details">
                                    <h4>Dr. Michael Chen</h4>
                                    <p>General Checkup • 2:30 PM</p>
                                </div>
                                <div class="appointment-status status-pending">Pending</div>
                            </div>
                        </div>
                    </div>

                    <!-- Today's Medications -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3 class="card-title">Today's Medications</h3>
                            <span class="view-all" onclick="showPage('medications')">View All</span>
                        </div>
                        <div class="medications-list">
                            <div class="medication-item" onclick="viewMedicationDetails()">
                                <div class="medication-icon" style="background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));">
                                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                                    </svg>
                                </div>
                                <div class="medication-details">
                                    <h4>Metformin</h4>
                                    <p>500mg • After meals</p>
                                </div>
                                <div class="medication-time">8:00 AM</div>
                            </div>
                            <div class="medication-item" onclick="viewMedicationDetails()">
                                <div class="medication-icon" style="background: linear-gradient(135deg, var(--success), #2d8e47);">
                                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                                    </svg>
                                </div>
                                <div class="medication-details">
                                    <h4>Lisinopril</h4>
                                    <p>10mg • Once daily</p>
                                </div>
                                <div class="medication-time">12:00 PM</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Health Assistant Page -->
            <div class="page-content" id="chatbot-page">
                <div class="chat-container">
                    <div class="chat-header">
                        <div class="chat-avatar">AI</div>
                        <div class="chat-info">
                            <h3>AI Health Assistant</h3>
                            <p>Ask me anything about your health</p>
                        </div>
                        <div class="chat-status">
                            <div class="status-dot"></div>
                            <span>Online</span>
                        </div>
                    </div>
                    <div class="chat-messages" id="chatMessages">
                        <div class="message bot">
                            <div class="message-avatar">AI</div>
                            <div class="message-content">
                                <div class="message-bubble">
                                    Hello! I'm your AI Health Assistant. How can I help you today? You can ask me about symptoms, medications, or general health advice.
                                </div>
                                <div class="message-time">Just now</div>
                            </div>
                        </div>
                    </div>
                    <div class="typing-indicator" id="typingIndicator">
                        <div class="message-avatar">AI</div>
                        <div class="typing-dots">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                    <div class="chat-input-area">
                        <div class="chat-input">
                            <input type="text" id="chatInput" placeholder="Type your health question here...">
                            <button class="attach-btn">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/>
                                </svg>
                            </button>
                        </div>
                        <button class="send-btn" id="sendBtn">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Appointments Page -->
            <div class="page-content" id="appointments-page">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">My Appointments</h3>
                        <button class="btn btn-primary" onclick="bookAppointment()">Book New Appointment</button>
                    </div>
                    <div class="appointments-list">
                        <div class="appointment-item" onclick="viewAppointmentDetails()">
                            <div class="appointment-date">
                                <div class="appointment-day">15</div>
                                <div class="appointment-month">MAR</div>
                            </div>
                            <div class="appointment-details">
                                <h4>Dr. Sarah Johnson - Cardiology</h4>
                                <p>10:00 AM • CareConnect Medical Center</p>
                            </div>
                            <div class="appointment-status status-confirmed">Confirmed</div>
                        </div>
                        <div class="appointment-item" onclick="viewAppointmentDetails()">
                            <div class="appointment-date">
                                <div class="appointment-day">22</div>
                                <div class="appointment-month">MAR</div>
                            </div>
                            <div class="appointment-details">
                                <h4>Dr. Michael Chen - General Checkup</h4>
                                <p>2:30 PM • CareConnect Medical Center</p>
                            </div>
                            <div class="appointment-status status-pending">Pending</div>
                        </div>
                        <div class="appointment-item" onclick="viewAppointmentDetails()">
                            <div class="appointment-date">
                                <div class="appointment-day">05</div>
                                <div class="appointment-month">APR</div>
                            </div>
                            <div class="appointment-details">
                                <h4>Dr. Emily Wilson - Dermatology</h4>
                                <p>11:15 AM • CareConnect Medical Center</p>
                            </div>
                            <div class="appointment-status status-confirmed">Confirmed</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Medications Page -->
            <div class="page-content" id="medications-page">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">My Medications</h3>
                        <button class="btn btn-primary" onclick="addMedication()">Add Medication</button>
                    </div>
                    <div class="medications-list">
                        <div class="medication-item" onclick="viewMedicationDetails()">
                            <div class="medication-icon" style="background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                                </svg>
                            </div>
                            <div class="medication-details">
                                <h4>Metformin</h4>
                                <p>500mg • For diabetes management</p>
                            </div>
                            <div class="medication-time">Twice daily</div>
                        </div>
                        <div class="medication-item" onclick="viewMedicationDetails()">
                            <div class="medication-icon" style="background: linear-gradient(135deg, var(--success), #2d8e47);">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                                </svg>
                            </div>
                            <div class="medication-details">
                                <h4>Lisinopril</h4>
                                <p>10mg • For high blood pressure</p>
                            </div>
                            <div class="medication-time">Once daily</div>
                        </div>
                        <div class="medication-item" onclick="viewMedicationDetails()">
                            <div class="medication-icon" style="background: linear-gradient(135deg, var(--warning), #e6a700);">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                                </svg>
                            </div>
                            <div class="medication-details">
                                <h4>Atorvastatin</h4>
                                <p>20mg • For cholesterol management</p>
                            </div>
                            <div class="medication-time">Once daily</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Medical Reports Page -->
            <div class="page-content" id="reports-page">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">Medical Reports</h3>
                        <button class="btn btn-primary" onclick="requestReport()">Request New Report</button>
                    </div>
                    <div class="appointments-list">
                        <div class="appointment-item">
                            <div class="appointment-date">
                                <div class="appointment-day">12</div>
                                <div class="appointment-month">FEB</div>
                            </div>
                            <div class="appointment-details">
                                <h4>Blood Test Results</h4>
                                <p>Complete Blood Count (CBC) • Dr. Sarah Johnson</p>
                            </div>
                            <button class="btn btn-primary" style="padding: 8px 16px; font-size: 13px;" onclick="viewReport()">View Report</button>
                        </div>
                        <div class="appointment-item">
                            <div class="appointment-date">
                                <div class="appointment-day">28</div>
                                <div class="appointment-month">JAN</div>
                            </div>
                            <div class="appointment-details">
                                <h4>Cardiology Checkup</h4>
                                <p>ECG and Stress Test • Dr. Sarah Johnson</p>
                            </div>
                            <button class="btn btn-primary" style="padding: 8px 16px; font-size: 13px;" onclick="viewReport()">View Report</button>
                        </div>
                        <div class="appointment-item">
                            <div class="appointment-date">
                                <div class="appointment-day">15</div>
                                <div class="appointment-month">JAN</div>
                            </div>
                            <div class="appointment-details">
                                <h4>Annual Physical Exam</h4>
                                <p>Comprehensive Health Assessment • Dr. Michael Chen</p>
                            </div>
                            <button class="btn btn-primary" style="padding: 8px 16px; font-size: 13px;" onclick="viewReport()">View Report</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notifications Page -->
            <div class="page-content" id="notifications-page">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">Notifications</h3>
                        <button class="btn btn-primary" onclick="markAllAsRead()">Mark All as Read</button>
                    </div>
                    <div class="notifications-list">
                        <div class="notification-item" onclick="viewNotification()">
                            <div class="notification-icon" style="background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                            </div>
                            <div class="notification-content">
                                <h4>Appointment Reminder</h4>
                                <p>Your appointment with Dr. Sarah Johnson is scheduled for March 15 at 10:00 AM.</p>
                                <div class="notification-time">2 hours ago</div>
                            </div>
                        </div>
                        <div class="notification-item" onclick="viewNotification()">
                            <div class="notification-icon" style="background: linear-gradient(135deg, var(--success), #2d8e47);">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                                </svg>
                            </div>
                            <div class="notification-content">
                                <h4>Test Results Available</h4>
                                <p>Your recent blood test results are now available in your medical reports.</p>
                                <div class="notification-time">1 day ago</div>
                            </div>
                        </div>
                        <div class="notification-item" onclick="viewNotification()">
                            <div class="notification-icon" style="background: linear-gradient(135deg, var(--warning), #e6a700);">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                                </svg>
                            </div>
                            <div class="notification-content">
                                <h4>Medication Refill</h4>
                                <p>Your prescription for Metformin is due for a refill. Please contact your pharmacy.</p>
                                <div class="notification-time">2 days ago</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Page -->
            <div class="page-content" id="profile-page">
                <div class="profile-section">
                    <div class="profile-card">
                        <div class="profile-header">
                            <div class="profile-avatar-large">JD</div>
                            <h2 class="profile-name">John Doe</h2>
                            <p class="profile-id">Patient ID: P-2024-0156</p>
                        </div>
                        <div class="profile-details">
                            <div class="detail-item">
                                <span class="detail-label">Date of Birth</span>
                                <span class="detail-value">March 15, 1985</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Gender</span>
                                <span class="detail-value">Male</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Blood Type</span>
                                <span class="detail-value">O+</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Phone</span>
                                <span class="detail-value">(555) 123-4567</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Email</span>
                                <span class="detail-value">john.doe@example.com</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Address</span>
                                <span class="detail-value">123 Main St, Anytown, USA</span>
                            </div>
                        </div>
                    </div>
                    <div class="profile-card">
                        <div class="card-header">
                            <h3 class="card-title">Medical Information</h3>
                        </div>
                        <div class="profile-details">
                            <div class="detail-item">
                                <span class="detail-label">Primary Physician</span>
                                <span class="detail-value">Dr. Michael Chen</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Insurance Provider</span>
                                <span class="detail-value">HealthCare Plus</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Policy Number</span>
                                <span class="detail-value">HCP-789456123</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Allergies</span>
                                <span class="detail-value">Penicillin, Peanuts</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Chronic Conditions</span>
                                <span class="detail-value">Type 2 Diabetes, Hypertension</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Emergency Contact</span>
                                <span class="detail-value">Jane Doe (555) 987-6543</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

                        <!-- Settings Page -->
            <div class="page-content" id="settings-page">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">Account Settings</h3>
                        <p class="page-subtitle">Manage your preferences and notification settings</p>
                    </div>
                    
                    <div class="settings-grid">
                        <div class="settings-card">
                            <h3>
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                                </svg>
                                Notifications
                            </h3>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">Appointment Reminders</div>
                                    <div class="setting-description">Get notified about upcoming appointments</div>
                                </div>
                                <div class="toggle-switch appointment-toggle active">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">Medication Alerts</div>
                                    <div class="setting-description">Receive medication reminder notifications</div>
                                </div>
                                <div class="toggle-switch medication-toggle active">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">Health Tips</div>
                                    <div class="setting-description">Get daily health tips and recommendations</div>
                                </div>
                                <div class="toggle-switch healthtips-toggle">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>
                        </div>

                        <div class="settings-card">
                            <h3>
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                                </svg>
                                Privacy & Security
                            </h3>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">Two-Factor Authentication</div>
                                    <div class="setting-description">Add an extra layer of security to your account</div>
                                </div>
                                <div class="toggle-switch twofactor-toggle">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">Data Sharing</div>
                                    <div class="setting-description">Allow anonymous data for research purposes</div>
                                </div>
                                <div class="toggle-switch datasharing-toggle active">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>
                        </div>

                        <div class="settings-card">
                            <h3>
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                Appearance
                            </h3>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">Dark Mode</div>
                                    <div class="setting-description">Switch between light and dark themes</div>
                                </div>
                                <div class="toggle-switch dark-mode-toggle">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">Large Text</div>
                                    <div class="setting-description">Increase text size for better readability</div>
                                </div>
                                <div class="toggle-switch largetext-toggle">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Call Selection Modal -->
    <div class="modal-overlay" id="callSelectionModal">
        <div class="call-selection-modal">

            <!-- Close button INSIDE the card -->
            <button class="call-close-btn" onclick="closeCallSelectionModal()">&times;</button>

            <div class="call-selection-header">
                <h2>Connect with Doctor</h2>
                <p>Choose your preferred consultation method</p>
            </div>

            <div class="call-options">
                <div class="call-option" onclick="startVideoCall()">
                    <div class="call-option-icon" style="background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="28" height="28">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                        </svg>
                    </div>
                    <div class="call-option-info">
                        <h3>Video Call</h3>
                        <p>Face-to-face consultation with video</p>
                    </div>
                </div>

                <div class="call-option" onclick="startVoiceCall()">
                    <div class="call-option-icon" style="background: linear-gradient(135deg, var(--success), #2d8e47);">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="28" height="28">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                        </svg>
                    </div>
                    <div class="call-option-info">
                        <h3>Voice Call</h3>
                        <p>Audio-only consultation</p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Video Call Modal -->
    <div class="modal-overlay" id="videoCallModal">
        <div class="doctor-modal">
            <div class="doctor-modal-header">
                <div class="doctor-modal-title">
                    <div class="doctor-avatar-large">DR</div>
                    <div class="doctor-info">
                        <h2>Dr. Virtual Assistant</h2>
                        <p>Video Consultation</p>
                    </div>
                </div>
                <button class="call-close-btn" onclick="endVideoCall()">&times;</button>
            </div>
            <div class="doctor-meeting">
                <div class="meeting-main">
<div class="video-container" 
     style="position:relative; width:100%; height:360px; border-radius:12px; 
            overflow:hidden; background:#08243a;">

    <!-- Remote video (doctor camera if any, otherwise unused) -->
    <video id="remoteVideo" autoplay playsinline
        style="position:absolute; inset:0; width:100%; height:100%;
               object-fit:cover; opacity:0;"></video>

    <!-- Patient camera preview (stays on top-right) -->
    <video id="localVideo" autoplay muted playsinline></video>


    <!-- Doctor avatar initials (OLD) – keeping for fallback -->

<div id="doctorAvatarContainer"
     style="
        position:absolute;
        left:18px; 
        bottom:18px; 
        width:300px; 
        height:300px;
        overflow:hidden;
        border-radius:12px;
        background:transparent;
        z-index:9999;
     ">
     <!-- videos will be injected dynamically via DoctorAvatar.init() -->
</div>






    <!-- Meeting controls -->
<!-- Meeting controls -->
<div class="meeting-controls"
     style="
        position:absolute;
        bottom:18px;
        left:50%;
        transform:translateX(-50%);
        display:flex;
        gap:18px;
        z-index:9999;
     ">

    <!-- Mute / Unmute -->
    <button class="control-btn"
            title="Mute"
            onclick="toggleLocalAudioMute(this)"
            style="
              width:52px;
              height:52px;
              border-radius:50%;
              background:rgba(255,255,255,0.18);
              backdrop-filter:blur(8px);
              border:none;
              display:flex;
              align-items:center;
              justify-content:center;
              cursor:pointer;
              transition:0.2s;
            ">
        <svg fill="none" stroke="white" viewBox="0 0 24 24" width="26" height="26">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
        </svg>
    </button>

    <!-- Camera On/Off -->
    <button class="control-btn"
            title="Video Off"
            onclick="toggleLocalVideoOff(this)"
            style="
              width:52px;
              height:52px;
              border-radius:50%;
              background:rgba(255,255,255,0.18);
              backdrop-filter:blur(8px);
              border:none;
              display:flex;
              align-items:center;
              justify-content:center;
              cursor:pointer;
              transition:0.2s;
            ">
        <svg fill="none" stroke="white" viewBox="0 0 24 24" width="26" height="26">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
        </svg>
    </button>

    <!-- End Call -->
    <button class="control-btn"
            title="End Call"
            onclick="endVideoCall()"
            style="
              width:52px;
              height:52px;
              border-radius:50%;
              background:#e44848;
              border:none;
              display:flex;
              align-items:center;
              justify-content:center;
              cursor:pointer;
              transition:0.2s;
            ">
        <svg fill="none" stroke="white" viewBox="0 0 24 24" width="26" height="26">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M16 8l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2M5 3a2 2 0 00-2 2v1c0 8.284 6.716 15 15 15h1a2 2 0 002-2v-3.28a1 1 0 00-.684-.948l-4.493-1.498a1 1 0 00-1.21.502l-1.13 2.257a11.042 11.042 0 01-5.516-5.517l2.257-1.128a1 1 0 00.502-1.21L9.228 3.683A1 1 0 008.279 3H5z"/>
        </svg>
    </button>

</div>

</div>


                    <div class="meeting-sidebar">
                        <div class="meeting-info">
                            <h3>Consultation Details</h3>
                            <p><strong>Doctor:</strong> Dr. Virtual Assistant</p>
                            <p><strong>Specialty:</strong> General Medicine</p>
                            <p><strong>Duration:</strong> <span id="videoCallTimer">00:00</span></p>
                            <p><strong>Status:</strong> <span style="color: var(--success);">Connected</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Voice Call Modal -->
    <div class="modal-overlay" id="voiceCallModal">
        <div class="doctor-modal">
            <div class="doctor-modal-header">
                <div class="doctor-modal-title">
                    <div class="doctor-avatar-large">DR</div>
                    <div class="doctor-info">
                        <h2>Dr. Virtual Assistant</h2>
                        <p>Voice Consultation</p>
                    </div>
                </div>
                <button class="call-close-btn" onclick="endVoiceCall()">&times;</button>
            </div>
            <div class="voice-call-container">
                <div class="call-avatar">DR</div>
                <div class="call-info">
                    <h2>Dr. Virtual Assistant</h2>
                    <p>Voice Consultation in Progress</p>
                </div>
                <div class="call-timer" id="voiceCallTimer">00:00</div>
                <div class="call-controls">
                    <button class="control-btn secondary" title="Mute">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
                        </svg>
                    </button>
                    <button class="control-btn primary" title="Speaker">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072M12 6a9 9 0 010 12m-4.5-9.5L12 3l4.5 4.5"/>
                        </svg>
                    </button>
                    <button class="control-btn danger" title="End Call" onclick="endVoiceCall()">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2M5 3a2 2 0 00-2 2v1c0 8.284 6.716 15 15 15h1a2 2 0 002-2v-3.28a1 1 0 00-.684-.948l-4.493-1.498a1 1 0 00-1.21.502l-1.13 2.257a11.042 11.042 0 01-5.516-5.517l2.257-1.128a1 1 0 00.502-1.21L9.228 3.683A1 1 0 008.279 3H5z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</html>
<script>
/* Integration glue: make existing markup calls work with the split modules */

function startVoiceCall() {
  // wire to voiceCallDialog open function
  if (window.CareConnectVoiceCall && typeof window.CareConnectVoiceCall.openDialog === "function") {
    window.CareConnectVoiceCall.openDialog();
    return;
  }
  // fallback: attempt to call the older startCall
  if (window.cc && typeof window.cc.videoCall?.startCall === "function") {
    window.cc.videoCall.startCall().catch(err => console.error("startCall() fallback failed:", err));
    return;
  }
  console.warn("startVoiceCall: no voice dialog available.");
  if (typeof showToast === "function") showToast("Voice-call dialog not available.", "error");
}
</script>

    </body>